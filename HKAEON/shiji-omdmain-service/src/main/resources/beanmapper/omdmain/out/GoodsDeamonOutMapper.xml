<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="beanmapper.out.GoodsDeamonOutMapper">
  <resultMap id="BaseResultMap" type="java.util.Map">
  	<id column="sgid" jdbcType="BIGINT" property="code" />
    <result column="entId" jdbcType="BIGINT" property="ent_id" />
    <result column="erpCode" jdbcType="VARCHAR" property="jygs" />
    <result column="goodsCode" jdbcType="VARCHAR" property="item_code" />
    <result column="barNo" jdbcType="VARCHAR" property="barcode" />
    <result column="goodsName" jdbcType="VARCHAR" property="item_name" />
    <result column="goodsType" jdbcType="INTEGER" property="typeid" />
    <result column="categoryId" jdbcType="BIGINT" property="categoryId" />
    <result column="categoryCode" jdbcType="VARCHAR" property="cat_code" />
    <result column="categoryName" jdbcType="VARCHAR" property="cat_name" />
    <result column="brandId" jdbcType="BIGINT" property="brandId" />
    <result column="brandCode" jdbcType="VARCHAR" property="brand_code" />
    <result column="brandName" jdbcType="VARCHAR" property="brand_name" />
    <result column="saleSpec" jdbcType="VARCHAR" property="spec" />
   	<result column="saleUnit" jdbcType="VARCHAR" property="unit" />
   	<result column="salePrice" jdbcType="DECIMAL" property="sale_price" />
   	<result column="vid" jdbcType="BIGINT" property="vendor_id" />
    <result column="goodsStatus" jdbcType="INTEGER" property="status" />
  </resultMap>
  <select id="search" parameterType="map" resultMap="BaseResultMap">
		SELECT
			s.sgid,s.entId,s.erpCode,s.goodsCode,s.goodsName,
			s.goodsType,s.categoryCode,s.brandCode,s.saleSpec,s.saleUnit,
			s.salePrice,s.goodsStatus,"aeon" as brandName,c.categoryName,
			CASE WHEN  m.barNo is null THEN s.barNo ELSE m.barNo END AS barNo
		FROM
			goods s
		LEFT JOIN
			category c
		ON  
			s.categoryId=c.categoryId 
		AND 
			s.entId=c.entId 
		LEFT JOIN
			goodsmorebarcode m
		ON  
			s.goodsCode=m.goodsCode
		AND
			m.barCodeType=1 
		AND 
			s.entId=m.entId 	
		WHERE 
			s.entId=#{entId,jdbcType=BIGINT}
		<if test="jygs != null">
			AND s.erpCode = #{jygs}
		</if>
		<if test="goodsCode != null">
			AND s.goodsCode IN
			<foreach collection="goodsCode" open="(" separator="," item="item" index="index" close=")">
				#{item}
			</foreach>
		</if>
		<if test="barNo != null">
			AND s.barNo IN
			<foreach collection="barNo" open="(" separator="," item="item" index="index" close=")">
				#{item}
			</foreach>
		</if>
		<if test="typeid != null">
			AND s.goodsType = #{typeid}
		</if>
		<if test="status != null">
			AND s.goodsStatus = #{status,jdbcType=INTEGER}
		</if>
		<if test="item_name != null">
			AND s.goodsName = #{item_name}
		</if>
		<if test="goodsName != null">
			AND s.goodsName like '%${goodsName}%'
		</if>
		<if test="vendor_id != null">
			AND s.vid = #{vendor_id}
		</if>
		<if test="cat_code != null ">
			AND s.categoryCode =#{cat_code}
		</if>
		<if test="brand_code != null">
			AND s.brandCode =#{brand_code}
		</if>
		<if test="page_no != null and page_size != null">
			limit ${page_no},${page_size}
		</if>
	</select>
	
	<select id="count" parameterType="map" resultType="long">
		SELECT
			count(1)
		FROM
			goods s	
		WHERE 
			s.entId=#{entId}
		<if test="jygs != null">
			AND s.erpCode = #{jygs}
		</if>
		<!-- 
		<if test="code != null">
			AND s.ssgid = #{code}
		</if>
		<if test="item_code != null">
			AND s.goodsCode = #{item_code}
		</if>
		<if test="barcode != null">
			AND s.barNo = #{barcode}
		</if> 
		-->
		<if test="goodsCode != null">
			AND s.goodsCode IN
			<foreach collection="goodsCode" open="(" separator="," item="item" index="index" close=")">
				#{item}
			</foreach>
		</if>
		<if test="barNo != null ">
			AND s.barNo IN
			<foreach collection="barNo" open="(" separator="," item="item" index="index" close=")">
				#{item}
			</foreach>
		</if>
		<if test="typeid != null">
			AND s.goodsType = #{typeid}
		</if>
		<if test="status != null">
			AND s.goodsStatus = #{status}
		</if>
		<if test="item_name != null">
			AND s.goodsName = #{item_name}
		</if>
		<if test="goodsName != null">
			AND s.goodsName like '%${goodsName}%'
		</if>
		<if test="vendor_id != null">
			AND s.vid = #{vendor_id}
		</if>
		<if test="cat_code != null ">
			AND s.categoryCode =#{cat_code}
		</if>
		<if test="brand_code != null">
			AND s.brandCode =#{brand_code}
		</if>
	</select>
</mapper>